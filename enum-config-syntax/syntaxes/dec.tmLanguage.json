{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Dralee Enum Config",
  "scopeName": "source.dec",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#table-name"
    },
    {
      "include": "#field-definition"
    }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.number-sign.configenum",
          "match": "(?<!\\$)#.*$"
        }
      ]
    },
    "table-name": {
      "patterns": [
        {
          "name": "meta.table-name.configenum",
          "match": "^\\[([^\\]]+)\\]",
          "captures": {
            "0": {
              "name": "entity.name.section.configenum"
            },
            "1": {
              "name": "entity.name.type.table.configenum"
            }
          }
        }
      ]
    },
    "field-definition": {
      "patterns": [
        {
          "include": "#field-ref-type"
        },
        {
          "include": "#field-enum-definition"
        },
        {
          "include": "#field-workflow-definition"
        }
      ]
    },
    "field-ref-type": {
      "patterns": [
        {
          "name": "meta.field-ref.configenum",
          "match": "^([a-zA-Z_][a-zA-Z0-9_]*)(==>)(\\$Ref\\$)([a-zA-Z_][a-zA-Z0-9_]*)\\s*$",
          "captures": {
            "1": {
              "name": "variable.other.field-name.configenum"
            },
            "2": {
              "name": "keyword.operator.assignment.configenum"
            },
            "3": {
              "name": "keyword.control.ref.configenum"
            },
            "4": {
              "name": "entity.name.type.enum-ref.configenum"
            }
          }
        }
      ]
    },
    "field-enum-definition": {
      "patterns": [
        {
          "name": "meta.field-enum.configenum",
          "begin": "^([a-zA-Z_][a-zA-Z0-9_]*)(==>)",
          "end": "(\\$#)([a-zA-Z_][a-zA-Z0-9_]*)(\\.Json)?\\s*$",
          "beginCaptures": {
            "1": {
              "name": "variable.other.field-name.configenum"
            },
            "2": {
              "name": "keyword.operator.assignment.configenum"
            }
          },
          "endCaptures": {
            "1": {
              "name": "keyword.operator.enum-type-separator.configenum"
            },
            "2": {
              "name": "entity.name.type.enum-type.configenum"
            },
            "3": {
              "name": "entity.name.type.enum-ref.configenum"
            }
          },
          "patterns": [
            {
              "include": "#field-description"
            },
            {
              "include": "#enum-items"
            }
          ]
        }
      ]
    },
    "field-description": {
      "patterns": [
        {
          "name": "string.unquoted.field-description.configenum",
          "match": "[^:：;；,，]+(?=[;；:：])"
        }
      ]
    },
    "enum-items": {
      "patterns": [
        {
          "name": "meta.enum-item.configenum",
          "match": "([0-9]+)\\s*([-:：])\\s*([^$,，]+?)(\\$\\$)([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": {
            "1": {
              "name": "constant.numeric.enum-value.configenum"
            },
            "2": {
              "name": "punctuation.separator.enum-desc.configenum"
            },
            "3": {
              "name": "string.unquoted.enum-description.configenum"
            },
            "4": {
              "name": "keyword.operator.enum-name-separator.configenum"
            },
            "5": {
              "name": "entity.name.constant.enum-name.configenum"
            }
          }
        },
        {
          "name": "punctuation.separator.enum-item.configenum",
          "match": "[,，]"
        }
      ]
    },
    "field-workflow-definition": {
      "patterns": [
        {
          "name": "meta.field-workflow.configenum",
          "begin": "^([a-zA-Z_][a-zA-Z0-9_]*)(==>)",
          "end": "([a-zA-Z_][a-zA-Z0-9_-]*)(:)([a-zA-Z_][a-zA-Z0-9_]*)(\\[[^\\[\\]]+\\])?\\s*$",
          "beginCaptures": {
            "1": {
              "name": "variable.other.table-name.workflow"
            },
            "2": {
              "name": "keyword.operator.assignment.workflow"
            }
          },
          "endCaptures": {
            "1": {
              "name": "entity.name.type.column-name.workflow"
            },
            "2": {
              "name": "keyword.operator.column-name-separator.workflow"
            },
            "3": {
              "name": "entity.name.type.column-des-name.workflow"
            }
          },
          "patterns": [
            {
              "include": "#workflow-items"
            }
          ]
        }
      ]
    },
    "workflow-items": {
      "patterns": [
        {
          "name": "meta.workflow-item.configenum",
          "match": "([a-zA-Z_][a-zA-Z0-9_-]*)\\s*([:])\\s*([a-zA-Z_][a-zA-Z0-9_]*)(\\[[^\\[\\]]+\\])?",
          "captures": {
            "1": {
              "name": "entity.name.constant.enum-name.configenum"
            },
            "2": {
              "name": "punctuation.separator.enum-desc.configenum"
            },
            "3": {
              "name": "constant.numeric.enum-value.configenum"
            },
            "4": {
              "name": "string.unquoted.enum-description.configenum"
            }
          }       
        },
        {
          "name": "punctuation.separator.workflow-item.configenum",
          "match": "[,]"
        },
        {
          "include": "#workflow-item-desc-name"
        }
      ]
    },
    "workflow-item-desc-name": {
      "patterns": [
        {
          "name": "meta.workflow-desc.configenum",
          "match": "^\\[([^\\[\\]]+)\\]",
          "captures": {
            "0": {
              "name": "entity.name.section.configenum"
            },
            "1": {
              "name": "entity.name.type.table.configenum"
            }
          }
        }
      ]
    }
  }
}